---
layout: blogger
title: Depurando site no IIS sem precisar elevar o Visual Studio
date: 2016-04-19T15:27:00.0010000-03:00
permalink: /:year/:month/:slug:output_ext
tags: [Visual Studio, Windows, Debug, IIS]
---
<img alt="Mensagem do Visual Studio solicitando executar como administrador para depurar site no IIS" border="0" height="320" src="https://lh3.googleusercontent.com/-_LzKxLTzyIQ/VxaI2IWVX9I/AAAAAAAAqkc/qayn1p4KHgQ/image%25255B29%25255D.png?imgmax=800" style="background-image: none; border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="Mensagem do Visual Studio solicitando executar como administrador para depurar site no IIS" width="640" /><br />Uma coisa que me incomoda bastante é ter que executar o Visual Studio como Administrador para poder depurar um web site hospedado no meu IIS local.<br /><a name='more'></a>Eu entendo perfeitamente o motivo disso, mas para quem não sabe, segue abaixo uma explicação rápida:<br /><ul><li>Por questões de segurança, usuários só têm permissão para depurar seus próprios processos, ou seja, não podem depurar processos de outros usuários. Isso acontece para proteger aplicações contra vírus e códigos maliciosos que poderiam interferir em outros aplicativos ou mesmo manipular a memória com intenção de corromper ou obter dados sigilosos.  </li><li>Sites no IIS são executados sob o usuário definido em seus Application Pools, portanto o seu usuário que está executando o IIS não tem permissão para depurar esses processos.  </li><li>Mesmo que seu usuário faça parte do grupo de administradores do computador, de modo geral ele roda como se não fosse administrador para proteger o sistema e só muda para modo elevado se você tentar executar alguma ação que necessite dessa permissão. Quando isso acontece, aparece aquela modal perguntando se você realmente deseja executar como administrador.</li></ul>A solução mais comum que se encontra na internet para esse problema costuma ser executar o Visual Studio como Administrador, mas essa solução me incomoda bastante pelos seguintes motivos:<br /><ul><li>Perdemos a integração com o shell do Windows, ou seja, não conseguimos mais arrastar e soltar arquivos do Windows Explorer para o Visual Studio (justamente pelo fato de serem processos de usuários diferentes)  </li><li>Ao dar um duplo clique em um arquivo qualquer que esteja vinculado ao Visual Studio (.sln, .csproj, .cs, .aspx, etc..) ele será aberto em uma nova instância do Visual Studio, mesmo que já exista uma instância aberta. Se configurarmos o Visual Studio para sempre abrir como Administrador, para cada arquivo que tentarmos abrir a partir do Windows Explorer teremos uma nova instância do VS.  </li><li>Sempre que executamos o Visual Studio como Administrador aparecerá aquele prompt de segurança para confirmarmos a operação, ou pior, teremos desabilitado o prompt para parar de incomodar e com isso reduzido a segurança do computador como um todo.</li></ul>Uma solução que eu tentei uma vez foi configurar o Application Pool dos meu sites no IIS para serem executados com meu usuário, mas nunca consegui fazer essa alternativa funcionar como deveria.<br />Até que achei uma solução onde não procurava: Remote Debugger!<br /><img alt="Remote Debugger" border="0" height="480" src="https://lh3.googleusercontent.com/-WpHzUAfij4s/VxaI2w8L9JI/AAAAAAAAqkg/0q_3q788rGY/image%25255B30%25255D.png?imgmax=800" style="background-image: none; border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="Remote Debugger" width="308" /><br />Pelos meus testes tem funcionado perfeitamente. É bem simples de usar:<br /><ul><li>Execute o aplicativo Remote Debugger como Administrador (ele é instalado junto com o Visual Studio).  </li><li>No Visual Studio, faça o procedimento normal de Debug > Attach to Process…, mas no campo Qualifier (onde deve estar escrito o nome do seu computador), mude para 127.0.0.1:4020 (ou outra porta qualquer que esteja configurada no Remote Debugger). Para ver a porta, vá em Tools Options no Remote Debugger.  </li><li>Agora é só achar o processo do IIS que está executando o site em questão e depurar!</li></ul>Se esses passos acima funcionarem, há uma opção melhor onde não será mais necessário iniciar o Remote Debugger sempre que for usar. <br /><ol><li>Basta instalar o serviço do Remote Debugger usando o aplicativo Remote Debugger Configuration Wizard, que também é instalado com o Visual Studio. A única pergunta que lhe será feita é para qual tipo de rede você vai permitir o debug. Eu marquei apenas a opção de redes Private.  </li><li>Depois vá ao gerenciador de Serviços do Windows e altere esse serviço recém instalado para que seja executado com seu usuário e não com o usuário LocalSystem. Se não fizer isso, sempre que tentar anexar o processo para depuração será solicitado um usuário e senha.</li></ol><img alt="Serviço do Remote Debugger configurado no Windows com usuário local e execução Automática" border="0" height="132" src="https://lh3.googleusercontent.com/-z5J76GT62gc/VxaI3mbcOJI/AAAAAAAAqkk/aL2CpOh_hNs/image%25255B31%25255D.png?imgmax=800" style="background-image: none; border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="Serviço do Remote Debugger configurado no Windows com usuário local e execução Automática" width="640" /><br />Meu computador agora está com o serviço do Remote Debugger configurado e em modo automático, assim não preciso mais abrir meu Visual Studio como Administrador para depurar sites hospedados no IIS.<br /><br /><b>Update 23/05/2017</b>: Link para a página de download do <a href="https://www.visualstudio.com/downloads/#remote-tools-for-visual-studio-2017" rel="nofollow" target="_blank">Remote Tools for Visual Studio 2017</a> e link direto, caso a página seja alterada no futuro: <a href="https://go.microsoft.com/fwlink/?LinkId=746570&clcid=0x409" rel="nofollow" target="_blank">vs_remotetools.exe</a>
